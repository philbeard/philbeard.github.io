<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/display.css">
<title>Phils Page</title>
</head>
<body class="body">
<div class="header">
	<h1>Welcome to Phils portfolio</h1>
</div>
<div class="main_content">
    <h1>Things I did for fun:</h1>
	<div class="main_content">
	    	<div id="games">
		<a href="http://philbeard.site88.net/adventuresofjake/" img="res/jakebro.jpg">
			<img border="2" alt="cool stuff" src="res/jakebro.jpg" width="200" height="200">
		</a>
		</div>
	</div>
</div>
<div>
	<h1>Useful snippets</h1>
	<h2>CSV email script:</h2>
	<div class="code">
	<p>
	// array of email addresses.
<br>	$to = array();
<br>	
<br>	function array2csv(array &$array)
<br>	{
<br>	   if (count($array) == 0) {
<br>	     return null;
<br>	   }
<br>	   $df = fopen("/tmp/report_".date('Y-m-d', strtotime("-1 days")).".csv", 'w');
<br>	   fputcsv($df, array_keys(reset($array)));
<br>	   foreach ($array as $row) {
<br>	      fputcsv($df, $row);
<br>	   }
<br>	   fclose($df);
<br>	}
<br>	
<br>	function getData(){
<br>	        $return = array();
<br>	        $dbDetails = readConfig();
<br>	        $table = '';
<br>	        $query = "SELECT ";
<br>	        $query .= "FROM ";
<br>	        $conn = new mysqli($dbDetails[server], $dbDetails[user], $dbDetails[pass], $dbDetails[database]);
<br>	        $result = $conn->query($query);
<br>	        while ($row = $result->fetch_assoc()){
<br>	                $return[] = $row;
<br>	        }
<br>			$conn->close();
<br>	        return $return;
<br>	}
<br>	
<br>	function emailCsv($csv_path, $body, $to = 'phil@email.co.uk', $subject = 'CSV Report data', $from = 'support@email.co.uk') {
<br>	        $logopt = '';
<br>	        $subject = escapeshellarg($subject);
<br>	        $attachment_path = escapeshellarg($csv_path);
<br>	        file_put_contents("/tmp/email.txt", $body);
<br>	        $txtfile = escapeshellarg("/tmp/email.txt");
<br>	        $from = escapeshellarg($from);
<br>	        foreach($to as $singleEmail){
<br>	                $emailto = escapeshellarg($singleEmail);
<br>	                `/usr/local/bin/sendEmail $logopt -q -f $from -t $emailto -u $subject -a $attachment_path -o "message-file="$txtfile`;
<br>	        }
<br>	}
<br>	
<br>	$data = getData();
<br>	
<br>	$body = "Please see attached CSV for " . date('Y-m-d', strtotime("-1 days"));
<br>	array2csv($data);
<br>	
<br>	emailCsv("/tmp/report_".date('Y-m-d', strtotime("-1 days")).".csv", $body, $to);
	</p>
	</div>
</div>
</body>
</html>
